(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-14d2e418"],{"4da1":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"topbar"},[s("el-input",{staticStyle:{width:"300px"},attrs:{size:"medium",placeholder:t.$t("admin.search-placeholder"),"prefix-icon":"el-icon-search"},on:{change:t.listRefresh},model:{value:t.query.email,callback:function(e){t.$set(t.query,"email",e)},expression:"query.email"}}),s("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"medium"},on:{click:t.createUser}},[t._v(t._s(t.$t("admin.btn-user-add")))])],1),s("el-card",{staticStyle:{"margin-top":"10px","padding-bottom":"20px"},attrs:{shadow:"never"}},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.rows,size:"medium"}},[s("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),s("el-table-column",{attrs:{prop:"profile.nickname",label:t.$t("admin.label-nickname"),width:"120"}}),s("el-table-column",{attrs:{prop:"email",label:t.$t("admin.label-email")}}),s("el-table-column",{attrs:{prop:"role",label:t.$t("admin.label-role"),width:"100"}}),s("el-table-column",{attrs:{prop:"status",label:t.$t("admin.label-status"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return["已激活"==e.row.status?s("el-tag",{attrs:{type:"success"}},[t._v(t._s(e.row.status))]):s("el-tag",{attrs:{type:"info"}},[t._v(t._s(e.row.status))])]}}])}),s("el-table-column",{attrs:{prop:"storage",label:t.$t("admin.label-storage"),width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.storage.used.format())+" / "+t._s(e.row.storage.max.format()))])]}}])}),s("el-table-column",{attrs:{prop:"operation",label:t.$t("admin.label-operation"),width:"280"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{size:"mini"},on:{click:function(s){return t.onStatusSwitch(e.$index,e.row)}}},[t._v(t._s(t.$t("op."+("已激活"==e.row.status?"disable":"enable"))))]),s("el-dropdown",{staticStyle:{"margin-left":"10px"},on:{command:function(s){t.onDropdownMenuClick(s,e.row)}}},[s("el-button",{attrs:{size:"mini"}},[t._v("高级"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{command:"edit-storage"}},[t._v(t._s(t.$t("admin.btn-quota-update")))]),s("el-dropdown-item",{attrs:{command:"reset-password"}},[t._v("重置密码")]),s("el-dropdown-item",{attrs:{command:"remove",divided:""}},[t._v(t._s(t.$t("op.delete")))])],1)],1)]}}])})],1),s("div",{staticStyle:{"margin-top":"20px"}},[s("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"prev, pager, next","current-page":t.pageNo,"page-size":t.query.limit,total:t.total},on:{"update:currentPage":function(e){t.pageNo=e},"update:current-page":function(e){t.pageNo=e},"current-change":t.listRefresh}})],1)],1)],1)},o=[],r=s("90fe"),i=s("6275"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:t.title,visible:t.visible,width:"35%"},on:{"update:visible":function(e){t.visible=e}}},[s("el-form",{ref:"form",staticStyle:{width:"85%"},attrs:{model:t.form,rules:t.rules}},[s("el-form-item",{attrs:{prop:"email",label:"邮箱","label-width":"100px"}},[s("el-input",{attrs:{placeholder:"电子邮箱",autofocus:""},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),s("el-form-item",{attrs:{prop:"role",label:"角色","label-width":"100px"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择用户角色"},model:{value:t.form.roles,callback:function(e){t.$set(t.form,"roles",e)},expression:"form.roles"}},t._l(t.roles,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),s("el-form-item",{attrs:{prop:"storage",label:"存储空间","label-width":"100px"}},[s("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请设置存储配额"},model:{value:t.form.storage,callback:function(e){t.$set(t.form,"storage",e)},expression:"form.storage"}},[s("el-select",{staticStyle:{width:"80px"},attrs:{slot:"append",placeholder:"单位"},slot:"append",model:{value:t.unitValue,callback:function(e){t.unitValue=e},expression:"unitValue"}},t._l(t.units,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),s("el-form-item",{attrs:{prop:"password",label:"密码","label-width":"100px"}},[s("el-input",{attrs:{type:"password",placeholder:"密码"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),s("el-form-item",{attrs:{prop:"password2",label:"密码确认","label-width":"100px"}},[s("el-input",{attrs:{type:"password",placeholder:"密码确认"},model:{value:t.form.password2,callback:function(e){t.$set(t.form,"password2",e)},expression:"form.password2"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"medium"},on:{click:t.close}},[t._v(t._s(t.$t("op.cancel")))]),s("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.submit}},[t._v(t._s(t.$t("op.confirm")))])],1)],1)},l=[],u=s("ebbf"),c={mixins:[u["b"]],props:{title:{type:String,default:""}},data:function(){var t=this,e=function(e,s,a){""===s?a(new Error("请输入密码")):(""!==t.form.password2&&t.$refs.form.validateField("password2"),a())},s=function(e,s,a){""===s?a(new Error("请再次输入密码")):s!==t.form.password?a(new Error("两次输入密码不一致!")):a()};return{roles:[{label:"管理员",value:"admin"},{label:"注册用户",value:"member"}],rules:{email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],password:[{validator:e,trigger:"blur",required:!0}],password2:[{validator:s,trigger:"blur",required:!0}]},unitValue:r["a"].bytesUnits()[2].value,form:{roles:"member",storage:100}}},computed:{units:function(){return r["a"].bytesUnits()}},methods:{submit:function(){var t=this;this.form.storage_max=Math.round(this.form.storage*this.unitValue),this.$zpan.User.signup(this.form).then((function(e){t.finish(),t.$message({type:"success",message:t.$t("msg.save-success")})}))}},mounted:function(){}},m=c,d=s("2877"),p=Object(d["a"])(m,n,l,!1,null,null,null),f=p.exports,h=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:t.$t("admin.label-quota-change"),visible:t.visible,width:"25%"},on:{"update:visible":function(e){t.visible=e}}},[s("el-form",{attrs:{model:t.form}},[s("el-form-item",{attrs:{label:t.$t("admin.label-quota"),"label-width":"110px"}},[s("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入内容"},model:{value:t.form.max.num,callback:function(e){t.$set(t.form.max,"num",e)},expression:"form.max.num"}},[s("el-select",{staticStyle:{width:"80px"},attrs:{slot:"append",placeholder:"单位"},slot:"append",model:{value:t.form.max.unitValue,callback:function(e){t.$set(t.form.max,"unitValue",e)},expression:"form.max.unitValue"}},t._l(t.units,(function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"medium"},on:{click:t.close}},[t._v(t._s(t.$t("op.cancel")))]),s("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.$t("op.confirm")))])],1)],1)},b=[],w={mixins:[u["b"]],props:{username:{type:String},form:{type:Object}},data:function(){return{}},computed:{units:function(){return r["a"].bytesUnits()}},methods:{onSubmit:function(){var t=this;this.form.max=Math.round(this.form.max.num*this.form.max.unitValue),this.$zpan.User.updateStorageByUser(this.username,this.form).then((function(e){t.finish(),t.$message({type:"success",message:t.$t("msg.save-success")})}))}},mounted:function(){}},v=w,g=Object(d["a"])(v,h,b,!1,null,null,null),$=g.exports,y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:t.$t("admin.label-password-reset"),visible:t.visible,width:"30%"},on:{"update:visible":function(e){t.visible=e}}},[s("el-form",{ref:"form",staticClass:"profile",staticStyle:{width:"85%"},attrs:{model:t.form,rules:t.rules,size:"medium","label-width":"100px"}},[s("el-form-item",{attrs:{label:"新密码",prop:"new_password"}},[s("el-input",{attrs:{type:"password"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),s("el-form-item",{attrs:{label:"密码确认",prop:"new_passwordr"}},[s("el-input",{attrs:{type:"password"},model:{value:t.form.passwordr,callback:function(e){t.$set(t.form,"passwordr",e)},expression:"form.passwordr"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"medium"},on:{click:t.close}},[t._v(t._s(t.$t("op.cancel")))]),s("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(e){return t.submit("form")}}},[t._v(t._s(t.$t("op.confirm")))])],1)],1)},x=[],_=(s("7f7f"),{mixins:[u["b"]],props:{username:{type:String}},data:function(){var t=this,e=function(e,s,a){""===s?a(new Error("请输入密码")):(""!==t.form.new_passwordr&&t.$refs.form.validateField("new_passwordr"),a())},s=function(e,s,a){""===s?a(new Error("请再次输入密码")):s!==t.form.new_password?a(new Error("两次输入密码不一致!")):a()};return{form:{},rules:{password:[{trigger:"blur",required:!0,validator:e}],passwordr:[{trigger:"blur",required:!0,validator:s}]}}},methods:{submit:function(t){var e=this;this.$refs[t].validate((function(t){t&&e.$zpan.User.updatePasswordByUser(e.username,e.form).then((function(t){e.finish(),e.$message({type:"success",message:"修改成功!"})}))}))}}}),k=_,S=Object(d["a"])(k,y,x,!1,null,null,null),z=S.exports,q={data:function(){return{query:{email:"",offset:0,limit:20},pageNo:1,rows:[],total:0}},methods:{listRefresh:function(){var t=this;this.query.offset=(this.pageNo-1)*this.query.limit,this.$zpan.User.list(this.query).then((function(e){t.rows=e.data.list.map((function(t){return t.storage.used=r["a"].formatBytes2(t.storage.used),t.storage.max=r["a"].formatBytes2(t.storage.max),t})),t.total=e.data.total}))},createUser:function(){var t=this;Object(i["a"])(f)({title:"添加用户"}).then((function(e){t.listRefresh()}))},onStatusSwitch:function(t,e){var s=this,a=1,o=2,r=Object.assign({},e),i=this.$t("op.enable"),n=i+this.$t("msg.success"),l=this.$t("tips.enable");"已禁用"==e.status?r.status=a:(r.status=o,i=this.$t("op.disable"),n=i+this.$t("msg.success"),l=this.$t("tips.disable")),this.$confirm(l,"".concat(i," ").concat(e.email),{type:"warning",confirmButtonText:this.$t("op.confirm"),cancelButtonText:this.$t("op.cancel")}).then((function(){s.$zpan.User.updateStatusByUser(e.username,r).then((function(t){s.$message({type:"success",message:n}),s.listRefresh()}))}))},onDropdownMenuClick:function(t,e){switch(t){case"edit-storage":this.onEditStorage(e);break;case"reset-password":this.onEditPassword(e);break;case"remove":this.onDelete(e);break;default:break}console.log(t)},onEditStorage:function(t){var e=this,s=Object.assign({},t.storage),a={username:t.username,form:s};Object(i["a"])($)(a).then((function(){e.listRefresh()}))},onEditPassword:function(t){var e=this;Object(i["a"])(z)({username:t.username}).then((function(t){e.listRefresh()}))},onDelete:function(t){var e=this;this.$confirm(this.$t("tips.remove"),this.$t("op.delete")+" ".concat(t.email),{type:"warning",confirmButtonText:this.$t("op.confirm"),cancelButtonText:this.$t("op.cancel")}).then((function(){e.$zpan.User.delete(t.username).then((function(t){e.$message({type:"success",message:e.$t("msg.delete-success")}),e.listRefresh()}))}))}},mounted:function(){this.listRefresh()}},E=q,U=(s("660f"),Object(d["a"])(E,a,o,!1,null,null,null));e["default"]=U.exports},6275:function(t,e,s){"use strict";s.d(e,"a",(function(){return l}));var a=s("8bbf"),o=s.n(a),r=s("9225"),i=s("c0d6"),n=s("41cb"),l=function(t){var e=o.a.extend(t);return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log(t);var s=new e({i18n:r["a"],store:i["a"],router:n["a"],propsData:t}).$mount(document.createElement("div"));return new Promise((function(t,e){s.$once("completed",(function(e){return t(e)})),s.$once("cancel",(function(t){return e(t)}))}))}}},"660f":function(t,e,s){"use strict";s("c0ba")},c0ba:function(t,e,s){},ebbf:function(t,e,s){"use strict";s.d(e,"a",(function(){return o})),s.d(e,"b",(function(){return i}));s("7f7f"),s("ac6a");var a={data:function(){return{cs:{}}},watch:{$route:function(t,e){this.setCs()}},computed:{},methods:{setCs:function(){var t=this;this.$store.state.storages.forEach((function(e){e.name==t.$route.params.sname&&(t.cs=e)}))},getSid:function(){return this.cs.id}},mounted:function(){this.setCs()}},o=a,r={data:function(){return{visible:!1}},watch:{visible:function(t){!t&&this.$destroy()}},mounted:function(){document.body.appendChild(this.$el),this.visible=!0},destroyed:function(){this.$el.parentNode.removeChild(this.$el)},methods:{open:function(){this.visible=!0},close:function(){this.visible=!1},completed:function(){this.$emit("completed")},finish:function(){this.close(),this.completed()}}},i=r}}]);